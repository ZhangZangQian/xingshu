import { Macro } from '../models/Macro';

/**
 * å®å¡ç‰‡ç»„ä»¶
 */
@Component
export struct MacroCard {
  @Prop macro: Macro;
  @Prop onToggle: (id: number, enabled: boolean) => void = () => {};
  @Prop onTrigger: (id: number) => void = () => {};
  @Prop onEdit: (id: number) => void = () => {};
  @Prop onDelete: (id: number) => void = () => {};

  build() {
    Card() {
      Column({ space: 12 }) {
        // æ ‡é¢˜è¡Œ
        Row() {
          // å›¾æ ‡
          if (this.macro.icon) {
            Image(this.macro.icon)
              .width(32)
              .height(32)
              .borderRadius(8)
          } else {
            Text('ğŸ“±')
              .fontSize(32)
          }

          // å®åç§°
          Text(this.macro.name)
            .fontSize(18)
            .fontWeight(FontWeight.Bold)
            .margin({ left: 12 })
            .flexGrow(1)

          // å¯ç”¨/ç¦ç”¨å¼€å…³
          Toggle({ type: ToggleType.Switch, isOn: this.macro.enabled })
            .onChange((isOn: boolean) => {
              this.onToggle(this.macro.id, isOn);
            })
        }
        .width('100%')
        .justifyContent(FlexAlign.SpaceBetween)

        // æè¿°
        if (this.macro.description) {
          Text(this.macro.description)
            .fontSize(14)
            .fontColor('#666666')
            .maxLines(2)
            .textOverflow({ overflow: TextOverflow.Ellipsis })
        }

        // æ“ä½œæŒ‰é’®
        Row({ space: 8 }) {
          Button('æ‰‹åŠ¨è§¦å‘')
            .fontSize(14)
            .height(32)
            .flexGrow(1)
            .onClick(() => {
              this.onTrigger(this.macro.id);
            })

          Button('ç¼–è¾‘')
            .fontSize(14)
            .height(32)
            .flexGrow(1)
            .backgroundColor('#f0f0f0')
            .fontColor('#333333')
            .onClick(() => {
              this.onEdit(this.macro.id);
            })

          Button('åˆ é™¤')
            .fontSize(14)
            .height(32)
            .flexGrow(1)
            .backgroundColor('#ff4d4f')
            .onClick(() => {
              this.onDelete(this.macro.id);
            })
        }
        .width('100%')

        // æ›´æ–°æ—¶é—´
        Text(`æ›´æ–°æ—¶é—´ï¼š${this.formatTime(this.macro.updatedAt)}`)
          .fontSize(12)
          .fontColor('#999999')
      }
      .padding(16)
      .width('100%')
    }
    .margin({ bottom: 12 })
    .width('100%')
  }

  /**
   * æ ¼å¼åŒ–æ—¶é—´æˆ³
   */
  private formatTime(timestamp: number): string {
    const date = new Date(timestamp);
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    const hours = String(date.getHours()).padStart(2, '0');
    const minutes = String(date.getMinutes()).padStart(2, '0');
    return `${year}-${month}-${day} ${hours}:${minutes}`;
  }
}
