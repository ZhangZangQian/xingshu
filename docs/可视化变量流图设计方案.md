# å¯è§†åŒ–å˜é‡æµå›¾è®¾è®¡æ–¹æ¡ˆ

## ä¸€ã€ç›®æ ‡

å®ç°ç±»ä¼¼ iOS å¿«æ·æŒ‡ä»¤çš„å¯è§†åŒ–å®ç¼–è¾‘å™¨ï¼Œè®©ç”¨æˆ·èƒ½å¤Ÿï¼š
1. æ¸…æ™°çœ‹åˆ°åŠ¨ä½œä¹‹é—´çš„å˜é‡æµå‘
2. é€šè¿‡å¯è§†åŒ–ç•Œé¢é…ç½®åŠ¨ä½œå‚æ•°
3. è‡ªåŠ¨æç¤ºå¯ç”¨å˜é‡ï¼Œé¿å…å¼•ç”¨ä¸å­˜åœ¨çš„å˜é‡
4. éªŒè¯é…ç½®æ­£ç¡®æ€§

## äºŒã€æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 2.1 ç»„ä»¶æ¶æ„

```
MacroEditorï¼ˆä¸»é¡µé¢ï¼‰
  â”œâ”€â”€ BasicInfoSectionï¼ˆåŸºæœ¬ä¿¡æ¯åŒºï¼‰
  â”œâ”€â”€ TriggerSectionï¼ˆè§¦å‘å™¨åŒºï¼‰
  â”œâ”€â”€ ActionFlowSectionï¼ˆåŠ¨ä½œæµç¨‹åŒºï¼‰NEW
  â”‚   â”œâ”€â”€ ActionCardï¼ˆåŠ¨ä½œå¡ç‰‡ï¼‰x N
  â”‚   â”‚   â”œâ”€â”€ ActionHeaderï¼ˆåŠ¨ä½œæ ‡é¢˜ï¼‰
  â”‚   â”‚   â”œâ”€â”€ ActionConfigï¼ˆé…ç½®æ‘˜è¦ï¼‰
  â”‚   â”‚   â”œâ”€â”€ VariableOutputï¼ˆè¾“å‡ºå˜é‡æ ‡ç­¾ï¼‰
  â”‚   â”‚   â””â”€â”€ ActionControlsï¼ˆæ“ä½œæŒ‰é’®ï¼‰
  â”‚   â””â”€â”€ VariableFlowLineï¼ˆå˜é‡æµå‘è¿çº¿ï¼‰
  â””â”€â”€ VariableSectionï¼ˆå˜é‡åŒºï¼‰

å¼¹å‡ºå±‚ï¼š
  â”œâ”€â”€ ActionConfigEditorï¼ˆåŠ¨ä½œé…ç½®ç¼–è¾‘å™¨ï¼‰NEW
  â”‚   â”œâ”€â”€ ClipboardConfigFormï¼ˆå‰ªè´´æ¿é…ç½®è¡¨å•ï¼‰
  â”‚   â”œâ”€â”€ TextProcessConfigFormï¼ˆæ–‡æœ¬å¤„ç†é…ç½®è¡¨å•ï¼‰
  â”‚   â”œâ”€â”€ HttpRequestConfigFormï¼ˆHTTP è¯·æ±‚é…ç½®è¡¨å•ï¼‰
  â”‚   â”œâ”€â”€ UserDialogConfigFormï¼ˆç”¨æˆ·å¯¹è¯æ¡†é…ç½®è¡¨å•ï¼‰
  â”‚   â””â”€â”€ VariableSelectorï¼ˆå˜é‡é€‰æ‹©å™¨ï¼‰NEW
  â””â”€â”€ VariableFlowGraphï¼ˆå˜é‡æµå›¾æŸ¥çœ‹å™¨ï¼‰NEWï¼ˆå¯é€‰ï¼‰
```

### 2.2 æ•°æ®ç»“æ„å¢å¼º

#### ActionViewModelï¼ˆåŠ¨ä½œè§†å›¾æ¨¡å‹ï¼‰
```typescript
export interface ActionViewModel {
  // åŸæœ‰å­—æ®µ
  id: number;
  macroId: number;
  type: ActionType;
  config: string;
  orderIndex: number;

  // æ–°å¢å­—æ®µ
  inputVariables: string[];      // æ­¤åŠ¨ä½œä½¿ç”¨çš„è¾“å…¥å˜é‡
  outputVariable?: string;        // æ­¤åŠ¨ä½œè¾“å‡ºçš„å˜é‡
  configSummary: string;          // é…ç½®æ‘˜è¦ï¼ˆæ˜¾ç¤ºåœ¨å¡ç‰‡ä¸Šï¼‰
  isValid: boolean;               // é…ç½®æ˜¯å¦æœ‰æ•ˆ
  validationErrors: string[];     // éªŒè¯é”™è¯¯ä¿¡æ¯
}
```

#### VariableFlowï¼ˆå˜é‡æµå‘ï¼‰
```typescript
export interface VariableFlow {
  variableName: string;           // å˜é‡å
  sourceActionIndex: number;      // æ¥æºåŠ¨ä½œç´¢å¼•
  targetActionIndices: number[];  // ä½¿ç”¨è¯¥å˜é‡çš„åŠ¨ä½œç´¢å¼•
  type: 'runtime' | 'macro' | 'global' | 'system';  // å˜é‡ç±»å‹
}
```

## ä¸‰ã€UI è®¾è®¡

### 3.1 åŠ¨ä½œå¡ç‰‡å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”µ 1. è¯»å–å‰ªè´´æ¿                      [ç¼–è¾‘] â”‚
â”‚                                            â”‚
â”‚ å°†å‰ªè´´æ¿å†…å®¹ä¿å­˜åˆ°å˜é‡                      â”‚
â”‚                                            â”‚
â”‚ è¾“å‡º â†’ [clipboard_content]                 â”‚
â”‚                                            â”‚
â”‚ [â†‘] [â†“] [åˆ é™¤]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ (è™šçº¿è¿æ¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ 2. æ–‡æœ¬å¤„ç† - æ­£åˆ™æå–            [ç¼–è¾‘] â”‚
â”‚                                            â”‚
â”‚ è¾“å…¥: {clipboard_content} â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚ æ­£åˆ™: https?://[^\s]+                â”‚     â”‚
â”‚                                      â”‚     â”‚
â”‚ è¾“å‡º â†’ [extracted_url]               â”‚     â”‚
â”‚                                      â”‚     â”‚
â”‚ [â†‘] [â†“] [åˆ é™¤]                       â”‚     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â†“ (è™šçº¿è¿æ¥)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¡ 3. HTTP POST è¯·æ±‚                [ç¼–è¾‘] â”‚
â”‚                                            â”‚
â”‚ URL: https://api.coze.cn/v1/workflow/run   â”‚
â”‚ Body: {"url": "{extracted_url}"} â†â”€â”€â”€â”˜     â”‚
â”‚                                            â”‚
â”‚ è¾“å‡º â†’ [api_response]                      â”‚
â”‚                                            â”‚
â”‚ [â†‘] [â†“] [åˆ é™¤]                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 åŠ¨ä½œé…ç½®ç¼–è¾‘å™¨ï¼ˆå…¨å±å¼¹çª—ï¼‰

#### ç¤ºä¾‹ï¼šæ–‡æœ¬å¤„ç†é…ç½®ç¼–è¾‘å™¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ–‡æœ¬å¤„ç†é…ç½®                   [å…³é—­] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                      â”‚
â”‚  æ“ä½œç±»å‹ *                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ âšª æ­£åˆ™æå–                    â”‚   â”‚
â”‚  â”‚ â—‹ æ–‡æœ¬æ›¿æ¢                    â”‚   â”‚
â”‚  â”‚ â—‹ æ–‡æœ¬åˆ†å‰²                    â”‚   â”‚
â”‚  â”‚ â—‹ å¤§å°å†™è½¬æ¢                  â”‚   â”‚
â”‚  â”‚ â—‹ URL ç¼–ç /è§£ç                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  è¾“å…¥æ¥æº *                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ {clipboard_content}     [â–¼]  â”‚   â”‚â† ä¸‹æ‹‰é€‰æ‹©å˜é‡
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  å¯ç”¨å˜é‡: clipboard_content, date  â”‚
â”‚                                      â”‚
â”‚  æ­£åˆ™è¡¨è¾¾å¼ *                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ https?://[^\s]+              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  å¸¸ç”¨æ¨¡æ¿: URL | é‚®ç®± | æ‰‹æœºå·     â”‚
â”‚                                      â”‚
â”‚  æ•è·ç»„ç´¢å¼•                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ 0 (å®Œæ•´åŒ¹é…)            [â–¼]  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚
â”‚  ä¿å­˜ç»“æœåˆ°å˜é‡ *                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ extracted_url                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  å˜é‡å‘½åè§„åˆ™: å­—æ¯å¼€å¤´ï¼Œå¯å«æ•°å­—    â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   å–æ¶ˆ   â”‚  â”‚   ä¿å­˜   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.3 å˜é‡é€‰æ‹©å™¨ç»„ä»¶

```typescript
@Component
struct VariableSelector {
  @State availableVariables: string[] = [];
  @State selectedVariable: string = '';
  @State showSystemVariables: boolean = true;

  onVariableSelected: (variable: string) => void;

  build() {
    Column() {
      // æœç´¢æ¡†
      TextInput({ placeholder: 'æœç´¢å˜é‡...' })

      // ç³»ç»Ÿå˜é‡
      if (this.showSystemVariables) {
        Text('ç³»ç»Ÿå˜é‡').fontSize(14).fontColor('#999')
        List() {
          ListItem() { Text('{date}').onClick(() => ...) }
          ListItem() { Text('{time}').onClick(() => ...) }
          ListItem() { Text('{clipboard}').onClick(() => ...) }
        }
      }

      // è¿è¡Œæ—¶å˜é‡
      Text('è¿è¡Œæ—¶å˜é‡').fontSize(14).fontColor('#999')
      List() {
        ForEach(this.availableVariables, (varName: string) => {
          ListItem() {
            Row() {
              Text(`{${varName}}`)
              Text('æ¥è‡ªåŠ¨ä½œ X').fontSize(12).fontColor('#999')
            }
          }
        })
      }
    }
  }
}
```

## å››ã€å˜é‡æµè¿½è¸ªç®—æ³•

### 4.1 å˜é‡åˆ†æå™¨

```typescript
export class VariableFlowAnalyzer {
  /**
   * åˆ†æåŠ¨ä½œåˆ—è¡¨ä¸­çš„å˜é‡æµå‘
   */
  static analyzeFlow(actions: Action[], macroVariables: Variable[]): VariableFlow[] {
    const flows: VariableFlow[] = [];
    const definedVariables = new Set<string>();

    // 1. æ·»åŠ å®å˜é‡å’Œå…¨å±€å˜é‡
    macroVariables.forEach(v => definedVariables.add(v.name));

    // 2. æ·»åŠ ç³»ç»Ÿå˜é‡
    ['date', 'time', 'timestamp', 'clipboard', 'network_type', 'battery_level']
      .forEach(v => definedVariables.add(v));

    // 3. éå†åŠ¨ä½œï¼Œæå–è¾“å…¥è¾“å‡ºå˜é‡
    actions.forEach((action, index) => {
      const config = JSON.parse(action.config);

      // æå–è¾“å‡ºå˜é‡
      const outputVar = this.extractOutputVariable(action.type, config);
      if (outputVar) {
        definedVariables.add(outputVar);
        flows.push({
          variableName: outputVar,
          sourceActionIndex: index,
          targetActionIndices: [],
          type: 'runtime'
        });
      }

      // æå–è¾“å…¥å˜é‡
      const inputVars = this.extractInputVariables(action.type, config);
      inputVars.forEach(varName => {
        const flow = flows.find(f => f.variableName === varName);
        if (flow) {
          flow.targetActionIndices.push(index);
        }
      });
    });

    return flows;
  }

  /**
   * æå–è¾“å‡ºå˜é‡
   */
  private static extractOutputVariable(type: ActionType, config: any): string | null {
    switch (type) {
      case ActionType.CLIPBOARD_READ:
        return config.saveToVariable || null;
      case ActionType.TEXT_PROCESS:
        return config.saveToVariable || null;
      case ActionType.HTTP_REQUEST:
        return config.saveResponseTo || null;
      case ActionType.USER_DIALOG:
        return config.saveToVariable || null;
      default:
        return null;
    }
  }

  /**
   * æå–è¾“å…¥å˜é‡ï¼ˆä»å­—ç¬¦ä¸²ä¸­è§£æ {varName}ï¼‰
   */
  private static extractInputVariables(type: ActionType, config: any): string[] {
    const variables: Set<string> = new Set();
    const regex = /\{([a-zA-Z_][a-zA-Z0-9_]*)\}/g;

    // é€’å½’æœç´¢é…ç½®å¯¹è±¡ä¸­çš„æ‰€æœ‰å­—ç¬¦ä¸²
    const searchObject = (obj: any) => {
      if (typeof obj === 'string') {
        let match;
        while ((match = regex.exec(obj)) !== null) {
          variables.add(match[1]);
        }
      } else if (typeof obj === 'object' && obj !== null) {
        Object.values(obj).forEach(searchObject);
      }
    };

    searchObject(config);
    return Array.from(variables);
  }

  /**
   * éªŒè¯åŠ¨ä½œé…ç½®
   */
  static validateAction(
    action: Action,
    index: number,
    definedVariables: Set<string>
  ): { isValid: boolean; errors: string[] } {
    const config = JSON.parse(action.config);
    const errors: string[] = [];

    // æ£€æŸ¥è¾“å…¥å˜é‡æ˜¯å¦å·²å®šä¹‰
    const inputVars = this.extractInputVariables(action.type, config);
    inputVars.forEach(varName => {
      if (!definedVariables.has(varName)) {
        errors.push(`å˜é‡ {${varName}} æœªå®šä¹‰`);
      }
    });

    // æ£€æŸ¥å¿…å¡«å­—æ®µ
    switch (action.type) {
      case ActionType.TEXT_PROCESS:
        if (!config.input) errors.push('è¾“å…¥æ¥æºä¸èƒ½ä¸ºç©º');
        if (config.operation === 'regex_extract' && !config.pattern) {
          errors.push('æ­£åˆ™è¡¨è¾¾å¼ä¸èƒ½ä¸ºç©º');
        }
        break;
      case ActionType.HTTP_REQUEST:
        if (!config.url) errors.push('URL ä¸èƒ½ä¸ºç©º');
        break;
      // ... å…¶ä»–ç±»å‹éªŒè¯
    }

    return { isValid: errors.length === 0, errors };
  }
}
```

### 4.2 é…ç½®æ‘˜è¦ç”Ÿæˆå™¨

```typescript
export class ActionConfigSummaryGenerator {
  static generate(action: Action): string {
    const config = JSON.parse(action.config);

    switch (action.type) {
      case ActionType.CLIPBOARD_READ:
        return `å°†å‰ªè´´æ¿å†…å®¹ä¿å­˜åˆ°å˜é‡`;

      case ActionType.TEXT_PROCESS:
        const opNames = {
          'regex_extract': 'æ­£åˆ™æå–',
          'replace': 'æ–‡æœ¬æ›¿æ¢',
          'split': 'æ–‡æœ¬åˆ†å‰²',
          'uppercase': 'è½¬å¤§å†™',
          'lowercase': 'è½¬å°å†™'
        };
        return `${opNames[config.operation] || config.operation}\nè¾“å…¥: ${config.input}`;

      case ActionType.HTTP_REQUEST:
        return `${config.method} ${config.url}`;

      case ActionType.USER_DIALOG:
        const typeNames = {
          'confirm': 'ç¡®è®¤å¯¹è¯æ¡†',
          'single_select': 'å•é€‰å¯¹è¯æ¡†',
          'multi_select': 'å¤šé€‰å¯¹è¯æ¡†',
          'text_input': 'æ–‡æœ¬è¾“å…¥å¯¹è¯æ¡†'
        };
        return `${typeNames[config.type]}: ${config.title}`;

      default:
        return '';
    }
  }
}
```

## äº”ã€å®ç°æ­¥éª¤

### é˜¶æ®µ 1ï¼šåŸºç¡€æ¶æ„ï¼ˆ2 å°æ—¶ï¼‰
- [x] åˆ›å»º `VariableFlowAnalyzer` å·¥å…·ç±»
- [x] åˆ›å»º `ActionConfigSummaryGenerator` å·¥å…·ç±»
- [x] æ‰©å±• `ActionViewModel` æ•°æ®æ¨¡å‹
- [x] åˆ›å»º `VariableSelector` ç»„ä»¶

### é˜¶æ®µ 2ï¼šåŠ¨ä½œé…ç½®ç¼–è¾‘å™¨ï¼ˆ4 å°æ—¶ï¼‰
- [ ] åˆ›å»º `ActionConfigEditor` åŸºç¡€ç»„ä»¶
- [ ] å®ç° `ClipboardConfigForm`
- [ ] å®ç° `TextProcessConfigForm`ï¼ˆé‡ç‚¹ï¼‰
- [ ] å®ç° `HttpRequestConfigForm`
- [ ] å®ç° `UserDialogConfigForm`
- [ ] é›†æˆå˜é‡éªŒè¯é€»è¾‘

### é˜¶æ®µ 3ï¼šå¯è§†åŒ–æµç¨‹å›¾ï¼ˆ3 å°æ—¶ï¼‰
- [ ] æ”¹é€  `MacroEditor` çš„åŠ¨ä½œåˆ—è¡¨ UI
- [ ] æ·»åŠ åŠ¨ä½œå¡ç‰‡æ ·å¼ï¼ˆè¾“å…¥/è¾“å‡ºå˜é‡æ ‡ç­¾ï¼‰
- [ ] å®ç°å˜é‡æµå‘è¿çº¿ï¼ˆä½¿ç”¨ Canvas æˆ– Line ç»„ä»¶ï¼‰
- [ ] æ·»åŠ å˜é‡è¿½è¸ªé«˜äº®åŠŸèƒ½

### é˜¶æ®µ 4ï¼šäº¤äº’ä¼˜åŒ–ï¼ˆ2 å°æ—¶ï¼‰
- [ ] æ·»åŠ åŠ¨ä½œæ—¶è‡ªåŠ¨æ¨èå˜é‡å
- [ ] æ‹–æ‹½è°ƒæ•´åŠ¨ä½œé¡ºåºæ—¶è‡ªåŠ¨é‡æ–°éªŒè¯
- [ ] åˆ é™¤åŠ¨ä½œæ—¶æç¤ºå½±å“çš„ä¸‹æ¸¸åŠ¨ä½œ
- [ ] æ·»åŠ "å¿«é€Ÿåˆ›å»ºå¿«å°çº¢æµç¨‹"æ¨¡æ¿

### é˜¶æ®µ 5ï¼šæµ‹è¯•å’Œæ–‡æ¡£ï¼ˆ1 å°æ—¶ï¼‰
- [ ] æµ‹è¯•å®Œæ•´çš„å¿«å°çº¢æµç¨‹åˆ›å»º
- [ ] æµ‹è¯•å˜é‡éªŒè¯é€»è¾‘
- [ ] æ›´æ–°ç”¨æˆ·æ–‡æ¡£

## å…­ã€æŠ€æœ¯éš¾ç‚¹å’Œè§£å†³æ–¹æ¡ˆ

### 6.1 HarmonyOS å¼¹çª—é™åˆ¶
**é—®é¢˜**ï¼špromptAction.showDialog ä¸æ”¯æŒå¤æ‚è¡¨å•

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ CustomDialog å…¨å±å¼¹çª—
```typescript
@CustomDialog
struct ActionConfigDialog {
  controller: CustomDialogController;
  @State formData: any = {};

  build() {
    Column() {
      // å…¨å±è¡¨å•å†…å®¹
    }
    .width('100%')
    .height('100%')
  }
}
```

### 6.2 å˜é‡æµå‘å¯è§†åŒ–è¿çº¿
**é—®é¢˜**ï¼šArkUI æ²¡æœ‰å†…ç½®æµç¨‹å›¾ç»„ä»¶

**è§£å†³æ–¹æ¡ˆ 1ï¼ˆç®€å•ï¼‰**ï¼šä½¿ç”¨ Unicode ç®­å¤´ç¬¦å·
```
åŠ¨ä½œ 1: è¾“å‡º â†’ [var1]
  â†“
åŠ¨ä½œ 2: è¾“å…¥ â† {var1}
```

**è§£å†³æ–¹æ¡ˆ 2ï¼ˆé«˜çº§ï¼‰**ï¼šä½¿ç”¨ Canvas ç»˜åˆ¶è¿çº¿
```typescript
Canvas(this.canvasContext)
  .width('100%')
  .height(200)
  .onReady(() => {
    // ç»˜åˆ¶è´å¡å°”æ›²çº¿è¿æ¥åŠ¨ä½œå¡ç‰‡
    this.canvasContext.beginPath();
    this.canvasContext.moveTo(x1, y1);
    this.canvasContext.bezierCurveTo(cp1x, cp1y, cp2x, cp2y, x2, y2);
    this.canvasContext.stroke();
  })
```

### 6.3 å˜é‡åè¾“å…¥è¾…åŠ©
**é—®é¢˜**ï¼šTextInput ä¸æ”¯æŒè‡ªåŠ¨è¡¥å…¨

**è§£å†³æ–¹æ¡ˆ**ï¼šè¾“å…¥æ—¶å¼¹å‡ºæµ®åŠ¨èœå•
```typescript
@State showVariableSuggestions: boolean = false;
@State suggestions: string[] = [];

TextInput()
  .onChange((value) => {
    if (value.includes('{')) {
      this.suggestions = this.filterVariables(value);
      this.showVariableSuggestions = true;
    }
  })

if (this.showVariableSuggestions) {
  List() {
    ForEach(this.suggestions, (suggestion) => {
      ListItem() { Text(suggestion).onClick(() => ...) }
    })
  }
  .position({ x: 0, y: inputY + inputHeight })
}
```

## ä¸ƒã€ç¤ºä¾‹ï¼šå¿«å°çº¢å®Œæ•´é…ç½®æµç¨‹

### ç”¨æˆ·æ“ä½œæµç¨‹
1. ç‚¹å‡»"æ·»åŠ è§¦å‘å™¨" â†’ é€‰æ‹©"æ‰‹åŠ¨è§¦å‘"
2. ç‚¹å‡»"æ·»åŠ åŠ¨ä½œ" â†’ é€‰æ‹©"è¯»å–å‰ªè´´æ¿"
   - é…ç½®ï¼šä¿å­˜åˆ°å˜é‡ â†’ `clipboard_content`
3. ç‚¹å‡»"æ·»åŠ åŠ¨ä½œ" â†’ é€‰æ‹©"æ–‡æœ¬å¤„ç†"
   - æ“ä½œç±»å‹ï¼šæ­£åˆ™æå–
   - è¾“å…¥æ¥æºï¼šä¸‹æ‹‰é€‰æ‹© `{clipboard_content}`
   - æ­£åˆ™è¡¨è¾¾å¼ï¼š`https?://[^\s]+`
   - ä¿å­˜åˆ°å˜é‡ï¼š`extracted_url`
4. ç‚¹å‡»"æ·»åŠ åŠ¨ä½œ" â†’ é€‰æ‹©"ç”¨æˆ·å¯¹è¯æ¡†"
   - ç±»å‹ï¼šå•é€‰å¯¹è¯æ¡†
   - æ ‡é¢˜ï¼šé€‰æ‹©çˆ†æ¬¾æ ‡è®°
   - é€‰é¡¹ï¼š["æ™®é€šæ¬¾", "æ½œåŠ›æ¬¾", "å¤§çˆ†æ¬¾"]
   - ä¿å­˜åˆ°å˜é‡ï¼š`quality`
5. ç‚¹å‡»"æ·»åŠ åŠ¨ä½œ" â†’ é€‰æ‹©"ç”¨æˆ·å¯¹è¯æ¡†"
   - ç±»å‹ï¼šå¤šé€‰å¯¹è¯æ¡†
   - æ ‡é¢˜ï¼šé€‰æ‹©åˆ†ç±»æ ‡ç­¾
   - é€‰é¡¹ï¼š["æ—¶å°šç¾å¦†", "æ—…æ¸¸å‡ºè¡Œ", ...]
   - ä¿å­˜åˆ°å˜é‡ï¼š`labels`
6. ç‚¹å‡»"æ·»åŠ åŠ¨ä½œ" â†’ é€‰æ‹©"HTTP è¯·æ±‚"
   - æ–¹æ³•ï¼šPOST
   - URLï¼š`https://api.coze.cn/v1/workflow/run`
   - Bodyï¼š
     ```json
     {
       "workflow_id": "7550495126771449906",
       "parameters": {
         "url": "{extracted_url}",
         "quality": "{quality}",
         "label": "{labels}"
       }
     }
     ```
   - ä¿å­˜å“åº”ï¼š`api_response`
7. ç‚¹å‡»"æ·»åŠ åŠ¨ä½œ" â†’ é€‰æ‹©"æ‰“å¼€ URL"
   - URLï¼š`https://example.feishu.cn/base/xxx`

### æœ€ç»ˆç”Ÿæˆçš„å¯è§†åŒ–æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸŸ¢ è§¦å‘å™¨: æ‰‹åŠ¨è§¦å‘                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è¯»å–å‰ªè´´æ¿                   [ç¼–è¾‘]â”‚
â”‚ è¾“å‡º â†’ clipboard_content            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. æ–‡æœ¬å¤„ç† - æ­£åˆ™æå–          [ç¼–è¾‘]â”‚
â”‚ è¾“å…¥: {clipboard_content}           â”‚
â”‚ æ­£åˆ™: https?://[^\s]+              â”‚
â”‚ è¾“å‡º â†’ extracted_url                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. ç”¨æˆ·å¯¹è¯æ¡† - å•é€‰            [ç¼–è¾‘]â”‚
â”‚ æ ‡é¢˜: é€‰æ‹©çˆ†æ¬¾æ ‡è®°                   â”‚
â”‚ è¾“å‡º â†’ quality                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ç”¨æˆ·å¯¹è¯æ¡† - å¤šé€‰            [ç¼–è¾‘]â”‚
â”‚ æ ‡é¢˜: é€‰æ‹©åˆ†ç±»æ ‡ç­¾                   â”‚
â”‚ è¾“å‡º â†’ labels                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. HTTP POST è¯·æ±‚               [ç¼–è¾‘]â”‚
â”‚ URL: https://api.coze.cn/...        â”‚
â”‚ ä½¿ç”¨å˜é‡: {extracted_url}, {quality}â”‚
â”‚           {labels}                  â”‚
â”‚ è¾“å‡º â†’ api_response                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. æ‰“å¼€ URL                     [ç¼–è¾‘]â”‚
â”‚ URL: https://example.feishu.cn/...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å…«ã€åç»­ä¼˜åŒ–æ–¹å‘

1. **æ™ºèƒ½å˜é‡æ¨è**ï¼šæ ¹æ®åŠ¨ä½œç±»å‹è‡ªåŠ¨æ¨èå¸¸ç”¨å˜é‡å
2. **é…ç½®æ¨¡æ¿åº“**ï¼šé¢„è®¾å¸¸è§æµç¨‹ï¼ˆAPI è°ƒç”¨ã€æ•°æ®é‡‡é›†ã€é€šçŸ¥æ¨é€ï¼‰
3. **è°ƒè¯•æ¨¡å¼**ï¼šé€æ­¥æ‰§è¡Œå®ï¼ŒæŸ¥çœ‹æ¯ä¸ªåŠ¨ä½œåçš„å˜é‡å€¼
4. **å¯¼å…¥å¯¼å‡º**ï¼šæ”¯æŒå®é…ç½®çš„ JSON å¯¼å…¥å¯¼å‡º
5. **åä½œåˆ†äº«**ï¼šç”Ÿæˆåˆ†äº«é“¾æ¥ï¼Œå…¶ä»–ç”¨æˆ·å¯ä¸€é”®å¯¼å…¥

## ä¹ã€å¼€å‘æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | å·¥ä½œé‡ | é¢„è®¡æ—¶é—´ |
|------|--------|----------|
| é˜¶æ®µ 1ï¼šåŸºç¡€æ¶æ„ | å·¥å…·ç±» + ç»„ä»¶ | 2 å°æ—¶ |
| é˜¶æ®µ 2ï¼šé…ç½®ç¼–è¾‘å™¨ | 5 ä¸ªè¡¨å•ç»„ä»¶ | 4 å°æ—¶ |
| é˜¶æ®µ 3ï¼šå¯è§†åŒ–æµç¨‹å›¾ | UI æ”¹é€  + è¿çº¿ | 3 å°æ—¶ |
| é˜¶æ®µ 4ï¼šäº¤äº’ä¼˜åŒ– | éªŒè¯ + æç¤º | 2 å°æ—¶ |
| é˜¶æ®µ 5ï¼šæµ‹è¯•å’Œæ–‡æ¡£ | é›†æˆæµ‹è¯• | 1 å°æ—¶ |
| **æ€»è®¡** | | **12 å°æ—¶** |

## åã€é£é™©å’Œåº”å¯¹

| é£é™© | å½±å“ | åº”å¯¹æªæ–½ |
|------|------|----------|
| CustomDialog æ€§èƒ½é—®é¢˜ | è¡¨å•å¤æ‚æ—¶å¡é¡¿ | ä¼˜åŒ–æ¸²æŸ“ï¼Œå»¶è¿ŸåŠ è½½ |
| Canvas è¿çº¿å¤æ‚åº¦é«˜ | å¼€å‘æ—¶é—´è¶…é¢„æœŸ | é™çº§ä½¿ç”¨ Unicode ç®­å¤´ |
| å˜é‡éªŒè¯é€»è¾‘å¤æ‚ | Bug å¤š | å……åˆ†çš„å•å…ƒæµ‹è¯• |
| ç”¨æˆ·å­¦ä¹ æˆæœ¬é«˜ | ä¸ä¼šä½¿ç”¨ | æ·»åŠ æ–°æ‰‹å¼•å¯¼å’Œæ¨¡æ¿ |

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2026-01-07
**ä½œè€…**: Claude
