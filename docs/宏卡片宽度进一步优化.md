# 宏卡片宽度进一步优化

## 优化日期
2025-01-11

## 问题描述
用户反馈卡片仍然太宽，需要进一步缩小以呈现更紧凑的正方形外观。

## 优化内容

### 1. 卡片尺寸大幅缩小

| 项目 | 之前尺寸 | 优化后尺寸 | 变化 |
|------|----------|-----------|------|
| 图标容器 | 60×60px | 50×50px | -16.7% |
| 图标字号 | 36px | 32px | -11.1% |
| 图标圆角 | 14px | 12px | -14.3% |
| 图标下边距 | 12px | 10px | -16.7% |
| 卡片内边距 | 12px | 10px | -16.7% |
| 卡片圆角 | 16px | 14px | -12.5% |
| 内容间距 | 8px | 6px | -25% |
| 标题字号 | 14px | 13px | -7.1% |
| 标签字号 | 9px | 8px | -11.1% |
| 标签间距 | 4px | 3px | -25% |
| 标签项间距 | 3px | 2px | -33.3% |
| 标签内边距 | 5px/2px | 4px/1px | -20%/-50% |
| 标签圆角 | 4px | 3px | -25% |
| 阴影半径 | 12px | 10px | -16.7% |
| 开关尺寸 | 28×18px | 24×16px | -14.3%/-11.1% |
| 开关边距 | 6px | 4px | -33.3% |

### 2. Grid 间距调整

| 项目 | 之前尺寸 | 优化后尺寸 | 变化 |
|------|----------|-----------|------|
| 列间距 | 12px | 10px | -16.7% |
| 行间距 | 12px | 10px | -16.7% |

## 优化效果

### 卡片高度计算（优化后）

假设屏幕宽度 375px：
- 左右边距：16px + 16px = 32px
- 列间距：10px
- 可用宽度：375 - 32 - 10 = 333px
- 单列宽度：333 / 2 = 166.5px

卡片高度计算：
- 顶部内边距：10px
- 图标容器：50px
- 图标下边距：10px
- 标题（2行，字号13px，行高1.3）：约 34px
- 内容间距：6px
- 标签：约 16px
- 底部内边距：10px
- **总高度：约 136px**

宽高比：166.5 / 136 ≈ 1.22（比之前更接近正方形）

### 视觉对比

**优化前**
```
┌─────────────────┐
│    ⚪         │  开关较大
│  ┌────────┐   │  图标较大
│  │  📱  │   │
│  └────────┘   │  标题较大
│  快小红宏      │  标签较大
│  ⏱️定时 🔔通知 │
└─────────────────┘
```

**优化后**
```
┌──────────┐
│   ⚪    │  开关缩小
│  ┌────┐ │  图标缩小
│  │ 📱 │ │  标题缩小
│  └────┘ │  标签缩小
│ 快小红   │
│ ⏱️定时  │
└──────────┘
```

## 代码实现

### MacroCard.ets - buildGridCard()

```typescript
@Builder
buildGridCard() {
  Stack({ alignContent: Alignment.TopEnd }) {
    // 卡片主体（纵向布局）
    Column() {
      // 图标容器（缩小）
      Column() {
        Text(this.getMacroIcon())
          .fontSize(32)  // 36 → 32
          .fontColor('#FFFFFF')
      }
      .width(50)  // 60 → 50
      .height(50)
      .borderRadius(12)  // 14 → 12
      .backgroundColor(this.getMacroColor())
      .shadow({
        radius: 6,  // 8 → 6
        color: '#26000000',
        offsetX: 0,
        offsetY: 2
      })
      .justifyContent(FlexAlign.Center)
      .margin({ bottom: 10 })  // 12 → 10

      // 内容区（标题 + 标签，缩小）
      Column({ space: 6 }) {  // 8 → 6
        Text(this.macro.name)
          .fontSize(13)  // 14 → 13
          .fontWeight(FontWeight.Medium)
          .fontColor('#1A1A1A')
          .maxLines(2)
          .textOverflow({ overflow: TextOverflow.Ellipsis })
          .textAlign(TextAlign.Center)
          .width('100%')
          .lineHeight(1.3)  // 新增：控制行高

        Row({ space: 3 }) {  // 4 → 3
          ForEach(this.getTriggerTags().slice(0, 2), (tag: TriggerTag) => {
            Row({ space: 2 }) {  // 3 → 2
              Text(tag.icon)
                .fontSize(8)  // 9 → 8
              Text(tag.text)
                .fontSize(8)  // 9 → 8
                .fontColor('#AEAEB2')
            }
            .padding({ left: 4, right: 4, top: 1, bottom: 1 })  // 5/2 → 4/1
            .borderRadius(3)  // 4 → 3
            .backgroundColor('#F2F2F7')
          })
        }
        .justifyContent(FlexAlign.Center)
        .width('100%')
      }
      .alignItems(HorizontalAlign.Center)
      .width('100%')
    }
    .padding(10)  // 12 → 10
    .width('100%')
    .backgroundColor('#FFFFFF')
    .borderRadius(14)  // 16 → 14
    .shadow({
      radius: 10,  // 12 → 10
      color: '#14000000',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      this.onTrigger(this.macro.id);
    })

    // 开关按钮（缩小）
    Toggle({ type: ToggleType.Switch, isOn: this.macro.enabled })
      .width(24)  // 28 → 24
      .height(16)  // 18 → 16
      .margin({ top: 4, right: 4 })  // 6 → 4
      .onChange((isOn: boolean) => {
        this.onToggle(this.macro.id, isOn);
      })
      .zIndex(10)
  }
}
```

### MacrosTab.ets - Grid 布局

```typescript
Grid() {
  ForEach(this.macros, (macro: Macro) => {
    GridItem() {
      MacroCard({ ... })
    }
  })
}
.columnsTemplate('1fr 1fr')
.columnsGap(10)  // 12 → 10
.rowsGap(10)     // 12 → 10
.padding({ left: 16, right: 16, top: 12, bottom: 80 })
.width('100%')
.height('100%')
```

## 设计原则

### 紧凑性
- 图标、字体、间距全面缩小
- 保持视觉平衡的同时减少空间占用

### 可读性
- 字号减小但保持在可读范围内（8-13px）
- 标签缩小但保持清晰度

### 一致性
- 所有元素按相同比例缩小
- 保持原有的视觉层次和比例关系

## 响应式适配

### 小屏幕（375px）
- 优化后的尺寸适配良好
- 卡片宽高比约 1.22

### 标准屏幕（390-428px）
- 卡片宽度增加但比例保持
- 视觉效果更平衡

### 极小屏幕（< 360px）
- 可能需要进一步调整
- 考虑使用单列布局

## 测试建议

### 视觉测试
- [ ] 检查卡片宽度是否合适
- [ ] 确认图标、文字是否清晰
- [ ] 验证宽高比是否接近正方形
- [ ] 检查不同屏幕尺寸下的显示

### 交互测试
- [ ] 开关按钮是否可点击
- [ ] 卡片点击是否响应正常
- [ ] 标签是否清晰可读
- [ ] 触摸区域是否足够

## 后续优化方向

1. **响应式尺寸**
   - 根据屏幕宽度动态调整卡片尺寸
   - 大屏幕适当增大卡片

2. **单列模式**
   - 极小屏幕自动切换为单列
   - 保持卡片正方形比例

3. **动态行数**
   - 根据标题长度动态显示 1-2 行
   - 保持卡片高度一致

4. **图标优化**
   - 支持用户自定义图标尺寸
   - 提供更多图标选项

## 文件变更清单

| 文件 | 修改类型 | 变更内容 |
|------|----------|----------|
| `components/MacroCard.ets` | 修改 | 全面缩小卡片尺寸 |
| `pages/MacrosTab.ets` | 修改 | 缩小 Grid 间距 |

## 总结

通过全面缩小图标、字体、间距等所有元素尺寸，卡片现在更加紧凑，宽度显著减小。优化后的卡片：

1. ✅ 宽度更窄，接近正方形比例
2. ✅ 保持视觉平衡和可读性
3. ✅ 所有元素按比例缩小
4. ✅ Grid 间距同步优化

卡片现在应该更符合用户预期的紧凑外观。
