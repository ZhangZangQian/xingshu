# 构建说明 - 避免网络依赖问题

## 问题分析

当前错误 "No authorization header was set for the request" 是因为 hvigor wrapper 尝试从网络下载依赖，但需要身份验证。

## 推荐解决方案

### 方案一：使用 DevEco Studio IDE 构建（推荐）✅

DevEco Studio 自带完整的构建工具，不需要网络依赖：

1. **在 DevEco Studio 中打开项目**
   - File → Open
   - 选择项目目录：`/Users/zhangyong/code/5/auto_harmony`

2. **等待项目同步完成**
   - DevEco Studio 会自动处理依赖

3. **构建项目**
   - 方法一：Build → Make Project
   - 方法二：Build → Build Haps
   - 方法三：点击工具栏的 ▶ Run 按钮

4. **查看构建输出**
   - HAP 包位置：`entry/build/default/outputs/default/`

**优点**：
- ✅ 不需要配置网络依赖
- ✅ IDE 自动处理版本兼容性
- ✅ 提供可视化错误提示
- ✅ 支持断点调试

---

### 方案二：使用 DevEco Studio 自带的 hvigor（命令行）

如果必须使用命令行，可以直接调用 DevEco Studio 自带的 hvigor：

```bash
# 设置环境变量
export DEVECO_STUDIO_HOME="/Volumes/DevEco-Studio/DevEco-Studio.app/Contents"
export HVIGOR_HOME="$DEVECO_STUDIO_HOME/tools/hvigor"

# 使用 DevEco Studio 自带的 hvigor
cd /Users/zhangyong/code/5/auto_harmony

# 清理
$DEVECO_STUDIO_HOME/tools/hvigor/bin/hvigor clean

# 构建
$DEVECO_STUDIO_HOME/tools/hvigor/bin/hvigor assembleHap --mode module -p module=entry@default -p product=default
```

---

### 方案三：配置离线构建环境

参考文档：[HarmonyOS Next-DevEco Studio(5.0.2)无网络环境配置](https://www.cnblogs.com/sdkt/p/18855720)

1. **在有网络的电脑上生成依赖**
   ```bash
   ohpm install
   ```

2. **复制依赖到离线电脑**
   - 复制 `oh_modules/` 文件夹
   - 复制 `oh-package-lock.json5` 文件

3. **配置 npm 离线模式**
   ```bash
   npm config set offline true
   ```

---

## 当前问题的根本原因

1. **版本不匹配**：项目配置的 hvigor 版本 (6.21.2) 需要从网络下载
2. **认证问题**：ohpm 仓库需要身份验证（access_token 或 SSH key）
3. **网络依赖**：hvigor wrapper 默认尝试从网络安装依赖

## 立即行动建议

**最简单的解决方案**：
1. 在 DevEco Studio IDE 中打开项目
2. 点击 Build → Make Project
3. 等待构建完成

如果必须使用命令行，请使用方案二中的命令直接调用 DevEco Studio 自带的 hvigor。

---

**参考文档**：
- [HarmonyOS Next-DevEco Studio(5.0.2)无网络环境配置](https://www.cnblogs.com/sdkt/p/18855720)
- [HarmonyOS：ohpm使用指导](https://www.cnblogs.com/strengthen/p/18508503)
- [DevEco Hvigor高效编译，构建过程新秘籍](https://www.cnblogs.com/HarmonyOSDev/p/17761149.html)

**生成时间**：2026-01-06
