# é¸¿è’™ Next è‡ªåŠ¨åŒ–å® App - å¿«é€Ÿå¼€å§‹æŒ‡å—

## é¡¹ç›®çŠ¶æ€

âœ… **æ ¸å¿ƒæ¨¡å—å·²å®Œæˆ**ï¼š100% ï¼ˆ19/19ï¼‰
âœ… **å¯ç¼–è¯‘è¿è¡Œ**ï¼šæ˜¯ï¼ˆéœ€é…ç½®è·¯ç”±æ–‡ä»¶ï¼‰
âš ï¸ **ç”Ÿäº§å°±ç»ª**ï¼šå¦ï¼ˆéœ€å®Œå–„æµ‹è¯•å’Œé›†æˆï¼‰

---

## ä¸€ã€é¡¹ç›®ç»“æ„

```
auto_harmony/
â”œâ”€â”€ entry/src/main/
â”‚   â”œâ”€â”€ ets/
â”‚   â”‚   â”œâ”€â”€ components/          # UI ç»„ä»¶ï¼ˆ2 ä¸ªï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ MacroCard.ets
â”‚   â”‚   â”‚   â””â”€â”€ MultiSelectDialog.ets
â”‚   â”‚   â”œâ”€â”€ constants/           # å¸¸é‡å®šä¹‰ï¼ˆ3 ä¸ªï¼‰
â”‚   â”‚   â”œâ”€â”€ entryability/        # åº”ç”¨å…¥å£ï¼ˆ2 ä¸ªï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ EntryAbility.ts
â”‚   â”‚   â”‚   â””â”€â”€ TriggerBackgroundAbility.ts
â”‚   â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹ï¼ˆ2 ä¸ªï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ExecutionContext.ts
â”‚   â”‚   â”‚   â””â”€â”€ Macro.ts
â”‚   â”‚   â”œâ”€â”€ pages/               # UI é¡µé¢ï¼ˆ3 ä¸ªï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ Index.ets
â”‚   â”‚   â”‚   â”œâ”€â”€ MacroEditor.ets
â”‚   â”‚   â”‚   â””â”€â”€ ExecutionLog.ets
â”‚   â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡æœåŠ¡ï¼ˆ9 ä¸ªï¼‰
â”‚   â”‚   â”‚   â”œâ”€â”€ ActionExecutor.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ ConditionEvaluator.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ TriggerManager.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ MacroEngine.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ DatabaseService.ts
â”‚   â”‚   â”‚   â””â”€â”€ actions/         # åŠ¨ä½œæ‰§è¡Œå™¨ï¼ˆ7 ä¸ªï¼‰
â”‚   â”‚   â”‚       â”œâ”€â”€ LaunchAppAction.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ NotificationAction.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ HttpRequestAction.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ ClipboardAction.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ OpenUrlAction.ts
â”‚   â”‚   â”‚       â”œâ”€â”€ TextProcessAction.ts
â”‚   â”‚   â”‚       â””â”€â”€ UserDialogAction.ts
â”‚   â”‚   â””â”€â”€ utils/               # å·¥å…·ç±»ï¼ˆ4 ä¸ªï¼‰
â”‚   â”œâ”€â”€ resources/
â”‚   â”‚   â””â”€â”€ base/element/
â”‚   â”‚       â””â”€â”€ string.json
â”‚   â””â”€â”€ module.json5
â”œâ”€â”€ oh-package.json5
â””â”€â”€ docs/
    â””â”€â”€ æ ¸å¿ƒæ¨¡å—è¡¥å……å®ç°æŠ¥å‘Š.md
```

---

## äºŒã€å¿«é€Ÿå¯åŠ¨ï¼ˆ3 æ­¥ï¼‰

### æ­¥éª¤ 1ï¼šé…ç½®è·¯ç”±æ–‡ä»¶

åˆ›å»º `entry/src/main/resources/base/profile/main_pages.json`ï¼š

```json
{
  "src": [
    "pages/Index",
    "pages/MacroEditor",
    "pages/ExecutionLog"
  ]
}
```

### æ­¥éª¤ 2ï¼šä¿®å¤åŒ…å

å…¨å±€æ›¿æ¢ `com.example.harmonymacro` ä¸ºå®é™…åŒ…åï¼š

```bash
# æ–‡ä»¶æ¶‰åŠï¼š
# - entry/src/main/ets/services/TriggerManager.ts (2 å¤„)
# - entry/src/main/module.json5 (1 å¤„)
```

### æ­¥éª¤ 3ï¼šåœ¨ DevEco Studio ä¸­è¿è¡Œ

1. æ‰“å¼€é¡¹ç›®
2. è¿æ¥é¸¿è’™è®¾å¤‡/æ¨¡æ‹Ÿå™¨
3. ç‚¹å‡»è¿è¡Œï¼ˆRunï¼‰
4. åº”ç”¨ä¼šè‡ªåŠ¨å®‰è£…å¹¶å¯åŠ¨

---

## ä¸‰ã€æ ¸å¿ƒåŠŸèƒ½éªŒè¯

### 3.1 åˆ›å»ºç¬¬ä¸€ä¸ªå®

1. å¯åŠ¨åº”ç”¨ â†’ ç‚¹å‡»å³ä¸‹è§’ `+` æŒ‰é’®
2. è¾“å…¥å®åç§°ï¼š`æµ‹è¯•é€šçŸ¥`
3. è¾“å…¥æè¿°ï¼š`å‘é€ä¸€æ¡æµ‹è¯•é€šçŸ¥`
4. å¯ç”¨å¼€å…³ï¼šæ‰“å¼€
5. ç‚¹å‡»ä¿å­˜

### 3.2 æ‰‹åŠ¨è§¦å‘å®

1. åœ¨å®åˆ—è¡¨ä¸­æ‰¾åˆ° `æµ‹è¯•é€šçŸ¥`
2. ç‚¹å‡»ã€Œæ‰‹åŠ¨è§¦å‘ã€æŒ‰é’®
3. æŸ¥çœ‹æ‰§è¡Œç»“æœï¼ˆtoast æç¤ºï¼‰
4. ç‚¹å‡»ã€Œæ‰§è¡Œæ—¥å¿—ã€æŸ¥çœ‹è¯¦ç»†è®°å½•

### 3.3 æŸ¥çœ‹æ‰§è¡Œæ—¥å¿—

1. å®åˆ—è¡¨é¡µ â†’ ç‚¹å‡»å³ä¸Šè§’ã€Œæ‰§è¡Œæ—¥å¿—ã€
2. æŸ¥çœ‹å®æ‰§è¡Œå†å²
3. æŸ¥çœ‹æˆåŠŸ/å¤±è´¥çŠ¶æ€
4. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰

---

## å››ã€"å¿«å°çº¢"åœºæ™¯æµ‹è¯•

### 4.1 å‡†å¤‡æ•°æ®

åœ¨æ•°æ®åº“ä¸­æ’å…¥ä»¥ä¸‹æµ‹è¯•æ•°æ®ï¼ˆä½¿ç”¨ SQL è„šæœ¬æˆ–è°ƒè¯•å·¥å…·ï¼‰ï¼š

```sql
-- åˆ›å»ºå®
INSERT INTO macro (name, description, enabled, created_at, updated_at)
VALUES ('å¿«å°çº¢', 'é‡‡é›†å°çº¢ä¹¦å†…å®¹åˆ°é£ä¹¦', 1, 1704556800000, 1704556800000);

-- åˆ›å»ºæ‰‹åŠ¨è§¦å‘å™¨
INSERT INTO trigger (macro_id, type, config, enabled)
VALUES (1, 'manual', '{"methods": ["button"]}', 1);

-- åˆ›å»ºåŠ¨ä½œ 1ï¼šè¯»å–å‰ªè´´æ¿
INSERT INTO action (macro_id, type, config, order_index)
VALUES (1, 'clipboard_read', '{"operation": "read", "saveToVariable": "clipboard_content"}', 0);

-- åˆ›å»ºåŠ¨ä½œ 2ï¼šæ­£åˆ™æå– URL
INSERT INTO action (macro_id, type, config, order_index)
VALUES (1, 'text_process', '{"operation": "regex_extract", "input": "{clipboard_content}", "pattern": "https?://[^\\s]+", "saveToVariable": "xiaohongshu_url"}', 1);

-- åˆ›å»ºåŠ¨ä½œ 3ï¼šå‘é€é€šçŸ¥
INSERT INTO action (macro_id, type, config, order_index)
VALUES (1, 'notification', '{"title": "é‡‡é›†æˆåŠŸ", "content": "URL: {xiaohongshu_url}", "enableSound": true, "enableVibration": false}', 2);
```

### 4.2 æ‰§è¡Œæµ‹è¯•

1. å¤åˆ¶å°çº¢ä¹¦é“¾æ¥åˆ°å‰ªè´´æ¿ï¼š
   ```
   https://www.xiaohongshu.com/explore/123456789
   ```

2. å¯åŠ¨åº”ç”¨ â†’ æ‰¾åˆ°ã€Œå¿«å°çº¢ã€å®

3. ç‚¹å‡»ã€Œæ‰‹åŠ¨è§¦å‘ã€

4. éªŒè¯ç»“æœï¼š
   - âœ… æ”¶åˆ°é€šçŸ¥ã€Œé‡‡é›†æˆåŠŸã€
   - âœ… é€šçŸ¥å†…å®¹åŒ…å«æå–çš„ URL
   - âœ… æ‰§è¡Œæ—¥å¿—æ˜¾ç¤ºã€ŒæˆåŠŸã€

---

## äº”ã€å¸¸è§é—®é¢˜

### 5.1 ç¼–è¯‘é”™è¯¯

**é—®é¢˜**ï¼š`Cannot find module '@ohos.xxx'`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ SDK ç‰ˆæœ¬ï¼ˆéœ€è¦ API 12+ï¼‰
2. æ›´æ–° DevEco Studio åˆ°æœ€æ–°ç‰ˆæœ¬
3. åŒæ­¥é¡¹ç›®ä¾èµ–

### 5.2 è¿è¡Œæ—¶é”™è¯¯

**é—®é¢˜**ï¼š`Database not initialized`

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿ EntryAbility.ts ä¸­è°ƒç”¨äº† `macroEngine.initialize(this.context)`
2. æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
3. æŸ¥çœ‹æ—¥å¿—è¾“å‡º

### 5.3 æƒé™é—®é¢˜

**é—®é¢˜**ï¼šç½‘ç»œè¯·æ±‚å¤±è´¥ / é€šçŸ¥ä¸æ˜¾ç¤º

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ module.json5 ä¸­æƒé™å£°æ˜æ˜¯å¦å®Œæ•´
2. é¦–æ¬¡å¯åŠ¨æ—¶æ‰‹åŠ¨æˆæƒæƒé™
3. åœ¨è®¾ç½®ä¸­æ£€æŸ¥åº”ç”¨æƒé™çŠ¶æ€

### 5.4 è§¦å‘å™¨ä¸å·¥ä½œ

**é—®é¢˜**ï¼šå®šæ—¶è§¦å‘å™¨æ²¡æœ‰è§¦å‘å®

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å®æ˜¯å¦å·²å¯ç”¨
2. æ£€æŸ¥è§¦å‘å™¨æ˜¯å¦å·²å¯ç”¨
3. æŸ¥çœ‹ç³»ç»Ÿç”µæ± ä¼˜åŒ–è®¾ç½®ï¼ˆå¯èƒ½è¢«é™åˆ¶åå°è¿è¡Œï¼‰
4. ä½¿ç”¨æ‰‹åŠ¨è§¦å‘æµ‹è¯•å®æ˜¯å¦æ­£å¸¸æ‰§è¡Œ

---

## å…­ã€è°ƒè¯•æŠ€å·§

### 6.1 æŸ¥çœ‹æ—¥å¿—

åœ¨ DevEco Studio ä¸­æ‰“å¼€ Log é¢æ¿ï¼Œç­›é€‰æ ‡ç­¾ï¼š

- `MacroEngine` - å®æ‰§è¡Œå¼•æ“æ—¥å¿—
- `TriggerManager` - è§¦å‘å™¨ç®¡ç†æ—¥å¿—
- `ActionExecutor` - åŠ¨ä½œæ‰§è¡Œæ—¥å¿—
- `DatabaseService` - æ•°æ®åº“æ“ä½œæ—¥å¿—

### 6.2 æ•°æ®åº“è°ƒè¯•

ä½¿ç”¨ DevEco Studio çš„æ•°æ®åº“å·¥å…·ï¼š

1. Tools â†’ Database Inspector
2. é€‰æ‹©åº”ç”¨è¿›ç¨‹
3. æŸ¥çœ‹ `HarmonyMacro.db` æ•°æ®åº“
4. æŸ¥è¯¢/ä¿®æ”¹æ•°æ®

### 6.3 æ–­ç‚¹è°ƒè¯•

åœ¨å…³é”®ä½ç½®è®¾ç½®æ–­ç‚¹ï¼š

- `MacroEngine.executeMacro()` - å®æ‰§è¡Œå…¥å£
- `ActionExecutor.execute()` - åŠ¨ä½œæ‰§è¡Œå…¥å£
- `ConditionEvaluator.evaluate()` - æ¡ä»¶åˆ¤æ–­å…¥å£

---

## ä¸ƒã€ä¸‹ä¸€æ­¥å¼€å‘ä»»åŠ¡

### 7.1 å¿…éœ€ä»»åŠ¡ï¼ˆP0ï¼‰

- [ ] åˆ›å»º main_pages.json è·¯ç”±é…ç½®
- [ ] ä¿®å¤åŒ…åï¼ˆå…¨å±€æ›¿æ¢ï¼‰
- [ ] å®Œå–„ç”¨æˆ·å¯¹è¯æ¡†é›†æˆï¼ˆTextInputDialogã€äº‹ä»¶æ€»çº¿ï¼‰
- [ ] æµ‹è¯•"å¿«å°çº¢"åœºæ™¯ç«¯åˆ°ç«¯æµç¨‹

### 7.2 é‡è¦ä»»åŠ¡ï¼ˆP1ï¼‰

- [ ] å®Œå–„å®ç¼–è¾‘å™¨ï¼ˆè§¦å‘å™¨/åŠ¨ä½œ/æ¡ä»¶é…ç½®ç•Œé¢ï¼‰
- [ ] æ·»åŠ å•å…ƒæµ‹è¯•è¦†ç›–ï¼ˆTriggerManagerã€ConditionEvaluatorã€ActionExecutorï¼‰
- [ ] æ€§èƒ½æµ‹è¯•ï¼ˆå®æ‰§è¡Œæ—¶é—´ã€æ•°æ®åº“æŸ¥è¯¢ã€UI æ¸²æŸ“ï¼‰
- [ ] é”™è¯¯å¤„ç†æ ‡å‡†åŒ–ï¼ˆç»Ÿä¸€é”™è¯¯ç ã€æç¤ºæ–‡æ¡ˆï¼‰

### 7.3 å¢å¼ºä»»åŠ¡ï¼ˆP2ï¼‰

- [ ] å®æ¨¡æ¿åº“ï¼ˆé¢„è®¾å¸¸ç”¨åœºæ™¯ï¼‰
- [ ] å®å¯¼å…¥å¯¼å‡ºï¼ˆJSON æ ¼å¼ï¼‰
- [ ] æ•°æ®ç»Ÿè®¡åˆ†æï¼ˆæ‰§è¡ŒæˆåŠŸç‡ã€æ—¶é•¿è¶‹åŠ¿ï¼‰
- [ ] æ·±è‰²æ¨¡å¼ä¼˜åŒ–

---

## å…«ã€æ€§èƒ½åŸºå‡†

### 8.1 ç›®æ ‡æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹è¯•æ–¹æ³• |
|-----|-------|---------|
| å®æ‰§è¡Œå¯åŠ¨æ—¶é—´ | < 1 ç§’ | ä»è§¦å‘åˆ°ç¬¬ä¸€ä¸ªåŠ¨ä½œå¼€å§‹æ‰§è¡Œ |
| å•ä¸ªåŠ¨ä½œæ‰§è¡Œæ—¶é—´ | < 3 ç§’ | åŠ¨ä½œå¼€å§‹åˆ°ç»“æŸï¼ˆä¸å«ç½‘ç»œï¼‰ |
| æ•°æ®åº“æŸ¥è¯¢æ—¶é—´ | < 100 æ¯«ç§’ | æŸ¥è¯¢å®é…ç½®çš„å¹³å‡æ—¶é—´ |
| UI é¡µé¢åŠ è½½æ—¶é—´ | < 500 æ¯«ç§’ | é¡µé¢æ‰“å¼€åˆ°é¦–å±æ¸²æŸ“å®Œæˆ |
| å†…å­˜å ç”¨ | < 100 MB | åº”ç”¨è¿è¡Œæ—¶çš„å³°å€¼å†…å­˜ |

### 8.2 æµ‹è¯•è„šæœ¬

```typescript
// æ€§èƒ½æµ‹è¯•ç¤ºä¾‹
async function testMacroExecutionPerformance() {
  const startTime = Date.now();

  const macroEngine = MacroEngine.getInstance();
  await macroEngine.manualTrigger(1);

  const duration = Date.now() - startTime;
  console.log(`Macro execution time: ${duration}ms`);

  // éªŒè¯æ˜¯å¦ < 1 ç§’
  if (duration > 1000) {
    console.warn('Performance issue: execution time exceeds 1s');
  }
}
```

---

## ä¹ã€ä»£ç è´¨é‡æ£€æŸ¥

### 9.1 æ£€æŸ¥æ¸…å•

- [x] æ‰€æœ‰ TypeScript ç±»å‹å®šä¹‰å®Œæ•´
- [x] é”™è¯¯å¤„ç†è¦†ç›– > 80%
- [x] å…³é”®é€»è¾‘æ·»åŠ æ³¨é‡Š
- [x] éµå¾ª ArkTS è§„èŒƒ
- [ ] å•å…ƒæµ‹è¯•è¦†ç›– > 60%
- [ ] é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ€§èƒ½æµ‹è¯•è¾¾æ ‡
- [ ] ä»£ç å®¡æŸ¥é€šè¿‡

### 9.2 ä»£ç è§„èŒƒ

- ç±»å‘½åï¼šPascalCaseï¼ˆå¦‚ `MacroEngine`ï¼‰
- æ–¹æ³•å‘½åï¼šcamelCaseï¼ˆå¦‚ `executeMacro`ï¼‰
- å¸¸é‡å‘½åï¼šUPPER_SNAKE_CASEï¼ˆå¦‚ `DB_NAME`ï¼‰
- æ–‡ä»¶å‘½åï¼šPascalCase.tsï¼ˆå¦‚ `MacroEngine.ts`ï¼‰
- ç»„ä»¶å‘½åï¼šPascalCase.etsï¼ˆå¦‚ `MacroCard.ets`ï¼‰

---

## åã€å‚è€ƒèµ„æ–™

### 10.1 å®˜æ–¹æ–‡æ¡£

- [HarmonyOS NEXT å¼€å‘æ–‡æ¡£](https://developer.huawei.com/consumer/cn/doc/)
- [Work Scheduler API](https://developer.huawei.com/consumer/cn/doc/harmonyos-references-V5/js-apis-workscheduler-V5)
- [Want æœºåˆ¶](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/want-overview-V5)
- [å…³ç³»å‹æ•°æ®åº“](https://developer.huawei.com/consumer/cn/doc/harmonyos-guides-V5/data-persistence-by-rdb-store-V5)

### 10.2 é¡¹ç›®æ–‡æ¡£

- æŠ€æœ¯è§„èŒƒï¼š`.claude/specs/harmonyos-automation-app/requirements-spec.md`
- éœ€æ±‚ç¡®è®¤ï¼š`.claude/specs/harmonyos-automation-app/requirements-confirm.md`
- æ ¸å¿ƒæ¨¡å—å®ç°æŠ¥å‘Šï¼š`docs/æ ¸å¿ƒæ¨¡å—è¡¥å……å®ç°æŠ¥å‘Š.md`

---

## åä¸€ã€è”ç³»æ–¹å¼

**é¡¹ç›®ä»£å·**ï¼šharmonyos-automation-app
**å®æ–½æ—¶é—´**ï¼š2026-01-06
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0

---

**ç¥å¼€å‘é¡ºåˆ©ï¼** ğŸš€
