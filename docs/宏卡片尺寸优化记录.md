# 宏卡片尺寸优化记录

## 优化日期
2025-01-11

## 问题描述
宏卡片在网格布局下显示过宽，需要调整尺寸以更好地适应屏幕空间。

## 优化内容

### 1. 网格模式卡片 (buildGridCard)

#### 调整项

| 项目 | 优化前 | 优化后 | 说明 |
|------|--------|--------|------|
| 标题字体 | 17px | 15px | 减小标题字号 |
| 开关尺寸 | 32×20px | 28×18px | 缩小开关尺寸 |
| 卡片内边距 | 12px | 10px | 减小内边距 |
| 触发器标签数量 | 全部显示 | 最多 2 个 | 限制标签数量避免换行 |
| 标签字体 | 12px / 11px | 10px / 10px | 减小标签字号 |
| 标签内边距 | 8px / 4px | 6px / 2px | 减小标签内边距 |
| 标签圆角 | 6px | 4px | 减小标签圆角 |
| 描述文本 | 15px, 最多 2 行 | 移除 | 网格模式移除描述 |

#### 优化效果
- 卡片宽度更紧凑，更好地适应 2 列网格
- 减少不必要的换行
- 视觉层次更清晰

### 2. 网格布局 (MacrosTab.ets)

#### 调整项

| 项目 | 优化前 | 优化后 | 说明 |
|------|--------|--------|------|
| 列间距 (columnsGap) | 12px | 10px | 减小列间距 |
| 行间距 (rowsGap) | 12px | 10px | 减小行间距 |

### 3. 列表模式 (MacrosTab.ets)

#### 调整项

| 项目 | 优化前 | 优化后 | 说明 |
|------|--------|--------|------|
| 卡片间距 (space) | 12px | 10px | 减小卡片间距 |

## 设计规范对照

### 与设计方案对比

设计方案中的网格卡片布局：
```
┌─────────────────────────────────┐
│  ┌─────┐  快小红宏    ⋯ 🔴   │
│  │ 📱  │                         │
│  └─────┘                         │
│  从小红书采集内容到飞书          │  <-- 描述（2行截断）
│  多维表格                         │
│  ⏱️ 定时 · 🔔 通知                │  <-- 触发器标签
└─────────────────────────────────┘
```

实际优化后的网格卡片布局：
```
┌──────────────────┐
│  ┌───┐  快小红│
│  │ 📱│  ⚪   │
│  └───┘         │
│  ⏱️定时         │  <-- 最多2个标签
└──────────────────┘
```

**优化原因**：
- 小屏幕设备上，2 列网格的卡片宽度有限
- 描述文本在网格模式下容易导致高度不一致
- 移除描述可以让卡片更紧凑统一

### 与 iPhone 快捷指令对比

iPhone 快捷指令卡片（参考）：
```
┌─────────────────────────────────┐
│  ┌─────┐                        │
│  │ 🎨  │  调节亮度              │
│  └─────┘                        │
│  将屏幕亮度调至 50%             │
└─────────────────────────────────┘
```

我们的卡片布局：
- 网格模式：图标 + 标题 + 触发器标签（紧凑）
- 列表模式：图标 + 标题 + 描述 + 触发器标签 + 时间戳（完整）

**差异说明**：
- 列表模式保留了完整信息，与设计方案一致
- 网格模式为了适配小屏幕进行了优化，移除了描述

## 代码修改

### MacroCard.ets - buildGridCard()

```typescript
@Builder
buildGridCard() {
  Column() {
    Row() {
      // 图标容器 (52×52px)
      Column() { ... }
      .width(52)
      .height(52)

      // 内容区
      Column({ space: 4 }) {
        // 标题 + 开关
        Row() {
          Text(this.macro.name)
            .fontSize(15)  // 17 → 15
            .fontWeight(FontWeight.Medium)
            .fontColor('#1A1A1A')
            .maxLines(2)  // 1 → 2，允许换行
            .textOverflow({ overflow: TextOverflow.Ellipsis })
            .flexGrow(1)

          Toggle({ type: ToggleType.Switch, isOn: this.macro.enabled })
            .width(28)   // 32 → 28
            .height(18)  // 20 → 18
        }

        // 触发器标签（最多 2 个）
        Row({ space: 6 }) {
          ForEach(this.getTriggerTags().slice(0, 2), ...) { ... }
        }
      }
    }
  }
  .padding(10)  // 12 → 10
}
```

### MacrosTab.ets - Grid 布局

```typescript
Grid() {
  ForEach(this.macros, (macro: Macro) => {
    GridItem() {
      MacroCard({ ... })
    }
  })
}
.columnsTemplate('1fr 1fr')
.columnsGap(10)  // 12 → 10
.rowsGap(10)     // 12 → 10
.padding({ left: 16, right: 16, top: 12, bottom: 80 })
```

### MacrosTab.ets - 列表模式

```typescript
Column({ space: 10 }) {  // 12 → 10
  ForEach(this.macros, (macro: Macro) => {
    MacroCard({ viewMode: 'list', ... })
  })
}
.padding({ left: 16, right: 16, top: 12, bottom: 80 })
```

## 响应式考虑

### 小屏幕设备 (< 375px)
- 网格卡片可能仍显拥挤
- 可考虑在极小屏幕使用单列列表模式

### 标准屏幕 (375-428px)
- 优化后的尺寸适配良好
- 2 列网格布局显示正常

### 平板设备 (> 768px)
- 未来可考虑 3 列网格布局
- 卡片尺寸可能需要适当放大

## 后续优化建议

1. **响应式列数**
   - 小屏幕：< 375px 使用单列
   - 标准屏幕：375-768px 使用 2 列
   - 平板：> 768px 使用 3 列

2. **动态卡片高度**
   - 根据内容自动调整高度
   - 避免固定高度导致的空白

3. **布局自适应**
   - 检测屏幕宽度，自动切换网格/列表模式

4. **折叠/展开功能**
   - 网格模式点击卡片展开显示描述
   - 类似 iOS 快捷指令的交互

## 测试建议

### 视觉测试
- [ ] 检查小屏幕设备上的显示效果
- [ ] 确认卡片宽度适配合理
- [ ] 验证标题不会过长溢出
- [ ] 确认触发器标签显示正常

### 交互测试
- [ ] 点击卡片执行宏是否正常
- [ ] 开关切换是否流畅
- [ ] 网格模式卡片间距是否合理

## 文件变更清单

| 文件 | 修改类型 | 变更内容 |
|------|----------|----------|
| `components/MacroCard.ets` | 修改 | 优化 buildGridCard 尺寸和布局 |
| `pages/MacrosTab.ets` | 修改 | 减小 Grid 和 Column 间距 |

## 总结

通过减小字体、间距、内边距，以及移除网格模式的描述文本，成功优化了宏卡片在网格布局下的显示效果。卡片现在更紧凑、更适配屏幕空间，同时保持了良好的视觉效果和可读性。
